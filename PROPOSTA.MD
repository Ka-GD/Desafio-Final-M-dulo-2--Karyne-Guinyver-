# üìÑ Plano de Seguran√ßa ‚Äî LojaZeta

## 1. Sum√°rio Executivo

A LojaZeta, um e-commerce em crescimento, opera em nuvem com Nginx, Node.js e PostgreSQL.  
Enfrenta amea√ßas como SQL Injection (SQLi), Cross-Site Scripting (XSS) e brute-force em `/login`.  
Esses riscos exigem refor√ßo imediato na prote√ß√£o de aplica√ß√µes e dados sens√≠veis.  

Ambiente atual apresenta vulnerabilidades: aus√™ncia de SIEM consolidado, logs dispersos e falta de testes de restaura√ß√£o.  
Equipe enxuta: dois desenvolvedores e um profissional de opera√ß√µes exigem estrat√©gia pragm√°tica e econ√¥mica.  

Prop√µe-se arquitetura de defesa em camadas, priorizando mitiga√ß√£o de amea√ßas cr√≠ticas.  
Cria√ß√£o de um monitoramento centralizado m√≠nimo vi√°vel (MVP SIEM) para consolidar logs, gerar alertas e aumentar visibilidade.  

Ser√° aplicado processo simplificado de Resposta a Incidentes (IR) baseado no framework NIST IR.  
Runbooks para SQLi, XSS, brute-force e indisponibilidade ser√£o desenvolvidos.  

**Ganhos esperados:**  
- Redu√ß√£o de indisponibilidade  
- Maior visibilidade e controle  
- Melhoria em MTTD e MTTR  
- Maior confian√ßa de clientes e stakeholders  

Abordagem 80/20: quick wins em 30 dias para elevar maturidade em seguran√ßa sem comprometer agilidade e or√ßamento.

---

## 2. Escopo e Metodologia

| Escopo Imediato | Fora do Escopo |
|-------------------|----------------|
| Seguran√ßa de aplica√ß√µes web | SOC 24/7 |
| Prote√ß√£o de identidade de usu√°rios e equipe | Testes avan√ßados de Red Team |
| Seguran√ßa de dados cr√≠ticos | SIEM corporativo completo |
| Implementa√ß√£o de monitoramento m√≠nimo vi√°vel | |
| Desenvolvimento de runbooks b√°sicos | |

### Metodologia
1. An√°lise do ambiente atual (Nginx, Node.js, PostgreSQL)  
2. Aplica√ß√£o de boas pr√°ticas de Blue Team  
3. Modelo de seguran√ßa em camadas  
4. Ciclo NIST IR:
   - Detec√ß√£o
   - Conten√ß√£o
   - Erradica√ß√£o
   - Recupera√ß√£o
   - Li√ß√µes aprendidas  

**Assun√ß√µes:**  
- Infraestrutura IaaS configur√°vel  
- Equipe com conhecimento b√°sico em Linux e administra√ß√£o de sistemas  

---

## 3. Arquitetura de Defesa (Camadas)

| Camada       | Medidas |
|--------------|---------|
| **Per√≠metro** | WAF gerenciado (Cloudflare/Nginx + ModSecurity CRS), rate limiting em `/login`, CAPTCHA |
| **Rede**      | Segmenta√ß√£o, banco em sub-rede privada, ACLs restritivas, Bastion host com MFA |
| **Host**      | Hardening CIS Benchmark, atualiza√ß√µes autom√°ticas, Fail2ban |
| **Aplica√ß√£o** | Valida√ß√£o/sanitiza√ß√£o de inputs, ORM seguro, MFA painel administrativo |
| **Dados**     | Criptografia TLS/HTTPS e em repouso, backups criptografados, testes peri√≥dicos |
| **Identidade**| Gest√£o centralizada de segredos, princ√≠pio do menor privil√©gio |

---

## 4. Monitoramento & SIEM

- Logs centralizados: Nginx, Node.js, PostgreSQL, SO, WAF  
- Centraliza√ß√£o via Loki + Grafana (poss√≠vel evolu√ß√£o para ELK Stack)  
- Alertas autom√°ticos:
  - Falhas de login
  - SQLi/XSS detectado
  - Erros cr√≠ticos
  - Falha em backups  

**M√©tricas acompanhadas:**  
- MTTD, MTTR, ataques bloqueados, cobertura de logs  

---

## 5. Resposta a Incidentes

**Processo IR (NIST):**
1. **Detec√ß√£o:** alertas WAF/SIEM, dashboards  
2. **Conten√ß√£o:** isolar inst√¢ncia, bloquear IPs, revogar credenciais  
3. **Erradica√ß√£o:** corrigir vulnerabilidades, aplicar patches  
4. **Recupera√ß√£o:** restaurar backups, monitorar tr√°fego  
5. **Li√ß√µes Aprendidas:** post-mortem em at√© 5 dias  

**Runbooks m√≠nimos:**  
- **SQLi:** bloquear IP, revisar logs, corrigir ORM  
- **XSS:** identificar payload, refor√ßar valida√ß√£o, atualizar WAF  
- **Brute-force:** bloqueio tempor√°rio, ajustar limites, redefinir senha  
- **Indisponibilidade:** restaurar backup, comunicar status, monitorar sistema  

---

## 6. Recomenda√ß√µes

### Quick Wins (30 dias)
- [ ] Ativar WAF e rate limiting em `/login`  
- [ ] Centralizar logs em Loki + Grafana  
- [ ] Testar restaura√ß√£o de backup  
- [ ] Criar runbooks b√°sicos  

### M√©dio Prazo (90 dias)
- [ ] Ativar MFA para devs/ops  
- [ ] Hardening automatizado  
- [ ] Dashboards de KPIs  
- [ ] Desenvolver playbooks expandidos  

### Longo Prazo (180 dias)
- [ ] Gest√£o centralizada de segredos  
- [ ] Regras customizadas no WAF  
- [ ] Treinamento cont√≠nuo em IR  

**Respons√°veis:**  
- Devs: seguran√ßa do c√≥digo, MFA, valida√ß√£o  
- Ops: hardening, logs, backup, monitoramento  
- Consultoria: configura√ß√£o SIEM, runbooks, melhores pr√°ticas  

---

## 7. Riscos, Custos e Assun√ß√µes

| Riscos | Custos | Assun√ß√µes |
|--------|--------|-----------|
| Equipe pequena: necessidade de prioriza√ß√£o | Loki + Grafana (open-source), Fail2ban | Infraestrutura IaaS integrada |
| Or√ßamento restrito: uso de ferramentas open-source | WAF gerenciado (~$20/m√™s) | Acesso root/admin |
| | Investimento em solu√ß√µes de r√°pido retorno | Conhecimento b√°sico em Linux e opera√ß√µes |

---

## 8. Conclus√£o

A implementa√ß√£o deste plano aumentar√° a resili√™ncia da LojaZeta frente a amea√ßas cr√≠ticas, protegendo dados, aplica√ß√µes e infraestrutura.  
Abordagem 80/20 garante resultados r√°pidos em 30 dias e evolu√ß√£o em 90 e 180 dias.

**Pr√≥ximos Passos:**  
- Validar escopo com equipe interna  
- Implementar quick wins  
- Testar resposta a incidentes  
- Monitorar KPIs e ajustar processos  

---

## Arquitetura de Defesa (Camadas)

```mermaid
flowchart TD
    Internet([üåê Internet])
    WAF[üîí WAF/CRS<br/>Prote√ß√£o Per√≠metro]
    LB[‚öôÔ∏è Load Balancer]
    APP[üíª App Node.js]
    DB[(üóÑÔ∏è PostgreSQL)]
    LOGS[üìä Logs Centralizados]
    IAM[üõ°Ô∏è Gest√£o de Identidade]

    Internet --> WAF
    WAF --> LB
    LB --> APP
    APP --> DB
    APP --> LOGS
    DB --> LOGS
    IAM --> APP
